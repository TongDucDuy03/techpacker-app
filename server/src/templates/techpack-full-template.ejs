<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tech Pack - <%= meta.productName || meta.articleName || 'Product' %>
  </title>
  <style>
    @page {
      size: A4 landscape;
      margin: 15mm 10mm;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      /* Ensure colors print correctly in PDF */
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }

    body {
      font-family: Arial, sans-serif;
      font-size: 11px;
      line-height: 1.4;
      background: white;
      padding: 20px;
      /* Ensure colors print correctly in PDF */
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }

    /* Image optimization for PDF size reduction */
    img {
      max-width: 100%;
      height: auto;
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
      /* Limit maximum dimensions to reduce PDF size */
      max-width: 1200px;
      max-height: 800px;
      object-fit: contain;
    }

    /* Specific constraints for different image types */
    .logo-cell img,
    .page-header img {
      max-width: 400px;
      max-height: 200px;
    }

    .product-images img {
      max-width: 500px;
      max-height: 600px;
    }

    /* BOM thumbnail images */
    .bom-image img,
    .grid-item img {
      max-width: 800px;
      max-height: 600px;
    }

    /* How to measure images */
    .how-to-measure img {
      max-width: 1000px;
      max-height: 700px;
    }

    /* Colorway images */
    .colorway-image img {
      max-width: 1000px;
      max-height: 700px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
    }

    /* Header chung cho m·ªçi section */
    .page-header {
      background: white;
      /* border: 2px solid #000; */
      border: none;
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
      position: relative;
      z-index: 10;
    }

    .page-header table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    .page-header td {
      border: 1px solid #000;
      padding: 6px 8px;
      font-size: 9px;
      vertical-align: top;
      word-wrap: break-word;
    }

    .page-title {
      text-align: center;
      font-weight: bold;
      font-size: 14px;
      padding: 8px;
      border-bottom: 2px solid #000;
      background: #fff;
    }

    .version-text {
      float: right;
      font-weight: normal;
    }

    .label {
      font-weight: bold;
      background: #e8e8e8;
      white-space: nowrap;
      width: 120px;
    }

    .value {
      background: #fff;
    }

    .logo-cell {
      width: 80px;
      text-align: center;
      vertical-align: middle;
      background: #fff;
      border-left: 2px solid #000;
      padding: 4px;
    }

    .product-images {
      display: flex;
      gap: 8px;
      justify-content: center;
      align-items: center;
    }

    .product-images img,
    .product-images div {
      width: 50px;
      height: 65px;
      object-fit: cover;
    }

    /* Section styles */
    .section {
      page-break-before: always;
      margin-bottom: 0;
      padding-top: 0;
    }

    .section:first-child {
      page-break-before: auto;
    }

    .section-content {
      padding: 0;
      margin-top: 10px;
      clear: both;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 15px;
    }

    .info-item {
      border: 1px solid #ddd;
      padding: 10px;
    }

    .info-item strong {
      display: block;
      color: #666;
      font-size: 8px;
      margin-bottom: 3px;
      text-transform: uppercase;
    }

    .info-item span {
      display: block;
      font-size: 10px;
    }

    /* Table styles */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
      font-size: 11px; /* Match body font-size for consistency */
    }

    th {
      background: #e8e8e8;
      padding: 6px;
      text-align: left;
      border: 1px solid #999;
      font-weight: bold;
      font-size: 8px;
    }

    td {
      padding: 6px;
      border: 1px solid #ccc;
      vertical-align: top;
    }

    .alt-row {
      /* background: #fafafa; */
      background: #e8e8e8;
    }

    .measurement-table td {
      text-align: center;
      font-size: 9px;
    }

    .measurement-table td:first-child,
    .measurement-table td:nth-child(2) {
      text-align: left;
      font-weight: bold;
    }

    .color-swatch {
      display: inline-block;
      width: 40px;
      height: 20px;
      border: 1px solid #999;
      vertical-align: middle;
      margin-right: 8px;
    }

    .notes {
      background: #fffacd;
      border-left: 4px solid #ffd700;
      padding: 12px;
      margin: 15px 0;
    }

    .notes strong {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
    }

    .size-badge {
      background: #666;
      color: white;
      padding: 4px 10px;
      border-radius: 3px;
      font-size: 10px;
      display: inline-block;
      margin: 2px;
    }

    h3 {
      margin: 15px 0 10px 0;
      font-size: 12px;
      font-weight: bold;
      clear: both;
    }

    /* ƒê·∫£m b·∫£o tables kh√¥ng b·ªã ƒë√® l√™n header */
    table:first-of-type {
      margin-top: 0;
    }
  </style>
</head>

<body>
  <div class="container">
    <%# Function ƒë·ªÉ t·∫°o header cho m·ªói section %>
      <% function renderSectionHeader(sectionTitle) { %>
        <div class="page-header">
          <div class="page-title">
            <%= sectionTitle %>
              <span class="version-text">Version <%= meta.version || '1' %></span>
          </div>
          <table>
            <colgroup>
              <col style="width: 8%;" />
              <col style="width: 12%;" />
              <col style="width: 12%;" />
              <col style="width: 12%;" />
              <col style="width: 20%;" />
              <col style="width: 12%;" />
              <col style="width: 12%;" />
              <col style="width: 8%;" />
            </colgroup>
            <tr>
              <td class="logo-cell" rowspan="4" style="width: 8%;">
                <% const hasLogo=images && images.companyLogo && images.companyLogo !=='‚Äî' &&
                  !images.companyLogo.includes('No Image'); %>
                  <% if (hasLogo) { %>
                    <img src="<%= images.companyLogo %>" alt="Company Logo"
                      style="max-width: 65px; max-height: 70px; object-fit: contain;" />
                    <% } else { %>
                      <strong style="font-size: 9px; display: block; text-align: center;">
                        <%= meta.brand || 'Company' %>
                      </strong>
                      <small style="font-size: 7px; display: block; text-align: center; color: #666;">Logo</small>
                      <% } %>
              </td>
              <td class="label" style="width: 12%;">Article Code</td>
              <td class="value" style="width: 12%;">
                <%= meta.articleCode || '-' %>
              </td>
              <td class="label" rowspan="2" style="width: 12%;">Description</td>
              <td class="value" rowspan="2" colspan="2" style="width: 32%;">
                <%= meta.description || meta.productDescription || '' %>
              </td>
              <td class="label" style="width: 12%;">Product Group</td>
              <td class="value" style="width: 12%;">
                <%= meta.category || 'Tops' %>
              </td>
              <td class="logo-cell" rowspan="4" style="width: 8%;">
                <div class="product-images">
                  <% const hasDesignSketch=images && images.coverImage && images.coverImage !=='‚Äî' &&
                    !images.coverImage.includes('No Image'); %>
                    <% if (hasDesignSketch) { %>
                      <img src="<%= images.coverImage %>" alt="Product"
                        style="width: 50px; height: 65px; object-fit: contain; border: 1px solid #ccc; background: #f9f9f9;" />
                      <% } else { %>
                        <div style="width: 50px; height: 65px; border: 1px solid #ccc; background: #f9f9f9;"></div>
                        <% } %>
                          <div style="width: 50px; height: 65px; border: 1px solid #ccc; background: #f9f9f9;"></div>
                </div>
              </td>
            </tr>
            <tr>
              <td class="label">Article Name</td>
              <td class="value" colspan="3">
                <%= meta.productName || meta.articleName || '-' %>
              </td>
              <td class="label">Product Sub-Category</td>
              <td class="value">
                <%= meta.productSubCategory || 'Short Sleeve' %>
              </td>
            </tr>
            <tr>
              <td class="label">Created On</td>
              <td class="value">
                <%= meta.createdAt || '-' %>
              </td>
              <td class="label" rowspan="2" style="width: 12%;">Material<br>Description</td>
              <td class="value" rowspan="2" colspan="2" style="width: 32%;">
                <%= meta.fabricDescription || '-' %>
                  <% if (meta.materialComposition) { %><br>
                    <%= meta.materialComposition %>
                      <% } %>
                        <% if (meta.supplier) { %><br>Supplier: <%= meta.supplier %>
                            <% } %>
              </td>
              <td class="label">Season</td>
              <td class="value">
                <%= meta.season || 'Active Development' %>
              </td>
            </tr>
            <tr>
              <td class="label">Last Modified</td>
              <td class="value">
                <%= meta.updatedAt || '-' %>
              </td>
              <td class="label">Life Cycle Stage</td>
              <td class="value">
                <%= meta.lifecycleStage || meta.status || 'Production' %>
              </td>
            </tr>
          </table>
        </div>
        <% } %>

          <%# 1. ARTICLE INFORMATION %>
            <div class="section">
              <% renderSectionHeader('Article Information'); %>
                <div class="section-content">
                  <div class="info-grid">
                    <div class="info-item">
                      <strong>Gender</strong>
                      <span>
                        <%= meta.gender || 'Unisex' %>
                      </span>
                    </div>
                    <div class="info-item">
                      <strong>Legacy Product Class</strong>
                      <span>
                        <%= meta.productClass || meta.category || '-' %>
                      </span>
                    </div>
                    <div class="info-item">
                      <strong>Fit Type</strong>
                      <span>
                        <%= meta.fitType || 'Relaxed' %>
                      </span>
                    </div>
                    <div class="info-item">
                      <strong>Technical Designer</strong>
                      <span>
                        <%= meta.designer || meta.technicalDesigner || '-' %>
                      </span>
                    </div>
                    <div class="info-item">
                      <strong>Brand</strong>
                      <span>
                        <%= meta.brand || '-' %>
                      </span>
                    </div>
                    <div class="info-item">
                      <strong>Target Market</strong>
                      <span>
                        <%= meta.targetMarket || '-' %>
                      </span>
                    </div>
                    <div class="info-item">
                      <strong>Price Point</strong>
                      <span>
                        <%= meta.pricePoint || '-' %>
                      </span>
                    </div>
                    <div class="info-item">
                      <strong>Retail Price</strong>
                      <span>
                        <%= meta.retailPrice ? meta.retailPrice + ' ' + (meta.currency || 'USD' ) : '-' %>
                      </span>
                    </div>
                  </div>
                  <% if (meta.productDescription || meta.description) { %>
                    <div style="margin-top: 15px">
                      <strong>DESCRIPTION:</strong>
                      <p style="margin-top: 5px; line-height: 1.6">
                        <%= meta.productDescription || meta.description %>
                      </p>
                    </div>
                    <% } %>

                  <!-- Design Sketch Section -->
                  <div style="margin-top: 25px; page-break-inside: avoid;">
                    <div style="font-weight: 700; font-size: 12px; text-transform: uppercase; margin-bottom: 12px; border-bottom: 2px solid #333; padding-bottom: 5px;">
                      DESIGN SKETCH
                    </div>
                    <% 
                      const designSketchImg = images && images.designSketch ? images.designSketch : (meta.designSketchUrl || '');
                      // Check if image is valid (not placeholder SVG)
                      const hasDesignSketch = designSketchImg && 
                        designSketchImg !== '‚Äî' && 
                        !designSketchImg.includes('No Image') &&
                        !designSketchImg.toLowerCase().includes('data:image/svg+xml') &&
                        designSketchImg.trim() !== '' &&
                        (designSketchImg.startsWith('data:image/jpeg') || 
                         designSketchImg.startsWith('data:image/png') ||
                         designSketchImg.startsWith('data:image/gif') ||
                         designSketchImg.startsWith('http'));
                    %>
                    <% if (hasDesignSketch) { %>
                      <div style="text-align: center; margin-top: 10px;">
                        <img 
                          src="<%= designSketchImg %>" 
                          alt="Design Sketch" 
                          style="max-width: 100%; max-height: 500px; object-fit: contain; border: 1px solid #ddd; border-radius: 4px; background: #f9f9f9;"
                        />
                      </div>
                    <% } else { %>
                      <div style="width: 100%; height: 300px; border: 2px dashed #ccc; border-radius: 4px; display: flex; align-items: center; justify-content: center; background: #f9f9f9; margin-top: 10px;">
                        <span style="color: #999; font-size: 11px;">No design sketch</span>
                      </div>
                    <% } %>
                  </div>

                      <!-- CH√àN N·ªòI DUNG CARE INSTRUCTIONS ·ªû ƒê√ÇY -->

                      <%# 8. CARE INSTRUCTIONS %>
                        <% if (meta.fabricDescription || articleSummary?.fabricAndComposition?.fabricDescription) { %>
                          <div class="section">
                            <% renderSectionHeader('Care Instructions'); %>
                              <div class="section-content">
                                <table style="width: 100%; border-collapse: collapse;">
                                  <tr>
                                    <td
                                      style="width: 280px; vertical-align: top; border: 1px solid #ddd; padding: 15px; background: #f9fafb;">
                                      <strong style="display: block; margin-bottom: 12px; font-size: 10px;">Care
                                        Symbols:</strong>
                                      <div style="font-size: 10px; line-height: 1.8;">
                                        <div style="padding: 4px 0; border-bottom: 1px solid #e5e7eb;">‚äû Machine Wash
                                          Warm</div>
                                        <div style="padding: 4px 0; border-bottom: 1px solid #e5e7eb;">‚äó Do Not Bleach
                                        </div>
                                        <div style="padding: 4px 0; border-bottom: 1px solid #e5e7eb;">‚óâ Tumble Dry Low
                                        </div>
                                        <div style="padding: 4px 0;">‚ñΩ Cool Iron</div>
                                      </div>
                                    </td>
                                    <td style="vertical-align: top; border: 1px solid #ddd; padding: 15px;">
                                      <strong style="display: block; margin-bottom: 10px; font-size: 10px;">Fiber
                                        Content & Instructions:</strong>
                                      <% if (meta.fabricDescription ||
                                        articleSummary?.fabricAndComposition?.materialInfo) { %>
                                        <p style="margin-bottom: 10px; font-size: 11px; font-weight: bold;">
                                          <%= meta.fabricDescription || articleSummary.fabricAndComposition.materialInfo
                                            %>
                                        </p>
                                        <% } %>
                                          <p style="margin-bottom: 6px; font-size: 9px; line-height: 1.5;">
                                            MACHINE WASH WARM, DO NOT BLEACH, TUMBLE DRY LOW, COOL IRON.
                                          </p>
                                          <p style="margin-bottom: 6px; font-size: 9px; line-height: 1.5;">
                                            LAVAR A M√ÅQUINA TIBIO, NO BLANQUEADOR, SECADO TEMP BAJA, PLANCHA FRIA.
                                          </p>
                                          <p style="font-size: 9px; line-height: 1.5;">
                                            LAVAGE EN MACHINE CHAUD, NE PAS JAVELLISER, S√àCHE-LINGE √Ä FAIBLE, FER
                                            REFROIDIR.
                                          </p>
                                    </td>
                                  </tr>
                                </table>
                              </div>
                          </div>
                          <% } %>
                            <!-- K·∫æT TH√öC N·ªòI DUNG CARE INSTRUCTIONS -->
                </div>
            </div>

            <%# 2. BILL OF MATERIALS %>
              <% if (bom && bom.parts && bom.parts.length> 0) { %>
                <div class="section">
                  <% renderSectionHeader('Bill of Materials'); %>
                    <div class="section-content">
                      <% const fabrics=[]; const trims=[]; const labels=[]; const packaging=[]; bom.parts.forEach(part=>
                        { part.items.forEach(item => { const partName = (part.partName || '').toLowerCase(); const
                        materialName = (item.materialName || '').toLowerCase(); if (partName.includes('fabric') ||
                        partName.includes('main') || materialName.includes('fabric')) { fabrics.push({...item, part:
                        part.partName}); } else if (partName.includes('label') || materialName.includes('label') ||
                        materialName.includes('hang')) { labels.push({...item, part: part.partName}); } else if
                        (partName.includes('packaging') || materialName.includes('polybag') ||
                        materialName.includes('clip') || materialName.includes('bag')) { packaging.push({...item, part:
                        part.partName}); } else { trims.push({...item, part: part.partName}); } }); }); %>

                        <% if (fabrics.length> 0) { %>
                          <h3>Fabric</h3>
                          <table>
                            <thead>
                              <tr>
                                <th style="width: 10%">Part</th>
                                <th style="width: 25%">Material</th>
                                <th style="width: 15%">Placement</th>
                                <th style="width: 8%">Size</th>
                                <th style="width: 8%">Qty</th>
                                <th style="width: 8%">UOM</th>
                                <th style="width: 12%">Supplier</th>
                                <th style="width: 14%">Comments</th>
                                <th style="width: 12%">Color Code</th>
                              </tr>
                            </thead>
                            <tbody>
                              <% fabrics.forEach((item, idx)=> { %>
                                <tr class="<%= idx % 2 === 1 ? 'alt-row' : '' %>">
                                  <td>
                                    <%= item.part || '-' %>
                                  </td>
                                  <td>
                                    <%= item.materialName || '-' %>
                                      <% if (item.sizeWidthUsage && item.sizeWidthUsage !=='‚Äî' ) { %><br /><small>
                                          <%= item.sizeWidthUsage %>
                                        </small>
                                        <% } %>
                                  </td>
                                  <td>
                                    <%= item.placement || 'None' %>
                                  </td>
                                  <td>
                                    <%= item.size || '-' %>
                                  </td>
                                  <td>
                                    <%= item.quantity || '0' %>
                                  </td>
                                  <td>
                                    <%= item.uom || 'Yards' %>
                                  </td>
                                  <td>
                                    <%= item.supplier || '-' %>
                                  </td>
                                  <td>
                                    <%= item.comments || '-' %>
                                  </td>
                                  <td style="font-size: 11px; line-height: 1.4; vertical-align: top;">
                                    <% if (item.color || item.pantone || item.hexCode) { %>
                                      <% if (item.color) { %>
                                        <span style="font-weight: 600; font-size: 11px;"><%= item.color %></span>
                                        <% if (item.pantone || item.hexCode) { %><br/><% } %>
                                      <% } %>
                                      <% if (item.pantone) { %>
                                        <span style="font-size: 11px;"><%= item.pantone %></span><br/>
                                      <% } %>
                                      <% if (item.hexCode) { %>
                                        <span style="display:inline-block; width:12px; height:12px; border:1px solid #999; border-radius:2px; background-color:<%= item.hexCode %>; vertical-align:middle; margin-right:4px;"></span><span style="font-size: 11px;"><%= item.hexCode %></span>
                                      <% } %>
                                    <% } else { %>
                                      -
                                    <% } %>
                                  </td>
                                </tr>
                                <% }); %>
                            </tbody>
                          </table>
                          <% } %>

                            <% if (trims.length> 0) { %>
                              <h3>Trims</h3>
                              <table>
                                <thead>
                                  <tr>
                                    <th style="width: 10%">Part</th>
                                    <th style="width: 25%">Material</th>
                                    <th style="width: 15%">Placement</th>
                                    <th style="width: 10%">Size</th>
                                    <th style="width: 8%">Qty</th>
                                    <th style="width: 8%">UOM</th>
                                    <th style="width: 10%">Supplier</th>
                                    <th style="width: 12%">Comments</th>
                                    <th style="width: 12%">Color Code</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <% trims.forEach((item, idx)=> { %>
                                    <tr class="<%= idx % 2 === 1 ? 'alt-row' : '' %>">
                                      <td>
                                        <%= item.part || '-' %>
                                      </td>
                                      <td>
                                        <%= item.materialName || '-' %>
                                      </td>
                                      <td>
                                        <%= item.placement || '-' %>
                                      </td>
                                      <td>
                                        <%= item.sizeWidthUsage || item.size || '-' %>
                                      </td>
                                      <td>
                                        <%= item.quantity || '0' %>
                                      </td>
                                      <td>
                                        <%= item.uom || 'Each' %>
                                      </td>
                                      <td>
                                        <%= item.supplier || '-' %>
                                      </td>
                                      <td>
                                        <%= item.comments || '-' %>
                                      </td>
                                      <td style="font-size: 11px; line-height: 1.4; vertical-align: top;">
                                        <% if (item.color || item.pantone || item.hexCode) { %>
                                          <% if (item.color) { %>
                                            <span style="font-weight: 600; font-size: 11px;"><%= item.color %></span>
                                            <% if (item.pantone || item.hexCode) { %><br/><% } %>
                                          <% } %>
                                          <% if (item.pantone) { %>
                                            <span style="font-size: 11px;"><%= item.pantone %></span><br/>
                                          <% } %>
                                          <% if (item.hexCode) { %>
                                            <span style="display:inline-block; width:12px; height:12px; border:1px solid #999; border-radius:2px; background-color:<%= item.hexCode %>; vertical-align:middle; margin-right:4px;"></span><span style="font-size: 11px;"><%= item.hexCode %></span>
                                          <% } %>
                                        <% } else { %>
                                          -
                                        <% } %>
                                      </td>
                                    </tr>
                                    <% }); %>
                                </tbody>
                              </table>
                              <% } %>

                                <% if (labels.length> 0) { %>
                                  <h3>Labels</h3>
                                  <table>
                                    <thead>
                                      <tr>
                                        <th style="width: 12%">Part</th>
                                        <th style="width: 28%">Material</th>
                                        <th style="width: 22%">Placement</th>
                                        <th style="width: 8%">Qty</th>
                                        <th style="width: 8%">UOM</th>
                                        <th style="width: 22%">Comments</th>
                                        <th style="width: 12%">Color Code</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      <% labels.forEach((item, idx)=> { %>
                                        <tr class="<%= idx % 2 === 1 ? 'alt-row' : '' %>">
                                          <td>
                                            <%= item.part || '-' %>
                                          </td>
                                          <td>
                                            <%= item.materialName || '-' %>
                                          </td>
                                          <td>
                                            <%= item.placement || '-' %>
                                          </td>
                                          <td>
                                            <%= item.quantity || '1' %>
                                          </td>
                                          <td>
                                            <%= item.uom || 'Each' %>
                                          </td>
                                          <td>
                                            <%= item.comments || '-' %>
                                          </td>
                                          <td style="font-size: 11px; line-height: 1.4; vertical-align: top;">
                                            <% if (item.color || item.pantone || item.hexCode) { %>
                                              <% if (item.color) { %>
                                                <span style="font-weight: 600; font-size: 11px;"><%= item.color %></span>
                                                <% if (item.pantone || item.hexCode) { %><br/><% } %>
                                              <% } %>
                                              <% if (item.pantone) { %>
                                                <span style="font-size: 11px;"><%= item.pantone %></span><br/>
                                              <% } %>
                                              <% if (item.hexCode) { %>
                                                <span style="display:inline-block; width:12px; height:12px; border:1px solid #999; border-radius:2px; background-color:<%= item.hexCode %>; vertical-align:middle; margin-right:4px;"></span><span style="font-size: 11px;"><%= item.hexCode %></span>
                                              <% } %>
                                            <% } else { %>
                                              -
                                            <% } %>
                                          </td>
                                        </tr>
                                        <% }); %>
                                    </tbody>
                                  </table>
                                  <% } %>

                                    <% if (packaging.length> 0) { %>
                                      <h3>Packaging</h3>
                                      <table>
                                        <thead>
                                          <tr>
                                            <th style="width: 12%">Part</th>
                                            <th style="width: 28%">Material</th>
                                            <th style="width: 10%">Qty</th>
                                            <th style="width: 10%">UOM</th>
                                            <th style="width: 18%">Supplier</th>
                                            <th style="width: 22%">Comments</th>
                                            <th style="width: 12%">Color Code</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          <% packaging.forEach((item, idx)=> { %>
                                            <tr class="<%= idx % 2 === 1 ? 'alt-row' : '' %>">
                                              <td>
                                                <%= item.part || '-' %>
                                              </td>
                                              <td>
                                                <%= item.materialName || '-' %>
                                              </td>
                                              <td>
                                                <%= item.quantity || '1' %>
                                              </td>
                                              <td>
                                                <%= item.uom || 'Each' %>
                                              </td>
                                              <td>
                                                <%= item.supplier || '-' %>
                                              </td>
                                              <td>
                                                <%= item.comments || '-' %>
                                              </td>
                                              <td style="font-size: 11px; line-height: 1.4; vertical-align: top;">
                                                <% if (item.color || item.pantone || item.hexCode) { %>
                                                  <% if (item.color) { %>
                                                    <span style="font-weight: 600; font-size: 11px;"><%= item.color %></span>
                                                    <% if (item.pantone || item.hexCode) { %><br/><% } %>
                                                  <% } %>
                                                  <% if (item.pantone) { %>
                                                    <span style="font-size: 11px;"><%= item.pantone %></span><br/>
                                                  <% } %>
                                                  <% if (item.hexCode) { %>
                                                    <span style="display:inline-block; width:12px; height:12px; border:1px solid #999; border-radius:2px; background-color:<%= item.hexCode %>; vertical-align:middle; margin-right:4px;"></span><span style="font-size: 11px;"><%= item.hexCode %></span>
                                                  <% } %>
                                                <% } else { %>
                                                  -
                                                <% } %>
                                              </td>
                                            </tr>
                                            <% }); %>
                                        </tbody>
                                      </table>
                                      <% } %>
                    </div>
                </div>
                <% } %>

                  <%# 3. MEASUREMENTS %>
                    <% if (measurements && measurements.rows && measurements.rows.length> 0) { %>
                      <div class="section">
                        <% renderSectionHeader('Measurement'); %>
                          <div class="section-content">
                            <% if (measurements.sizeRange && measurements.sizeRange.length> 0) { %>
                              <div style="margin-bottom: 15px">
                                <strong>SIZE RANGE:</strong>
                                <div style="margin-top: 8px">
                                  <% measurements.sizeRange.forEach(size=> { %>
                                    <span class="size-badge">
                                      <%= size %>
                                    </span>
                                    <% }); %>
                                </div>
                              </div>
                              <% } %>

                                <div style="overflow-x: auto">
                                  <table class="measurement-table">
                                    <thead>
                                      <tr>
                                        <th>POM Code</th>
                                        <th>Measurement Point</th>
                                        <th>-Tol</th>
                                        <th>+Tol</th>
                                        <% if (measurements.sizeRange) { measurements.sizeRange.forEach(size=> { %>
                                          <th>
                                            <%= size %>
                                          </th>
                                          <% }); } %>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      <% measurements.rows.forEach((row, index)=> {
                                        const highlightCodes = ['BL20', 'BL21', 'AB11', 'AB30', 'AB70', 'AH10', 'SL10'];
                                        const shouldHighlight = highlightCodes.some(code =>
                                        row.pomCode?.includes(code));
                                        const baseSize = measurements.baseSize;
                                        %>
                                        <tr
                                          style="<%= shouldHighlight ? 'background: #ffe;' : (index % 2 === 1 ? 'background: #e8e8e8;' : '') %>">
                                          <td>
                                            <%= row.pomCode || '-' %>
                                          </td>
                                          <td>
                                            <%= row.pomName || '-' %>
                                          </td>
                                          <td>
                                            <%= row.minusTolerance || '0' %>
                                          </td>
                                          <td>
                                            <%= row.plusTolerance || '0' %>
                                          </td>
                                          <% if (measurements.sizeRange) { measurements.sizeRange.forEach(size=> { %>
                                            <td style="<%= size === baseSize ? 'background: #79e5a5;' : '' %>">
                                              <%= row.sizes?.[size] || '-' %>
                                            </td>
                                            <% }); } %>
                                        </tr>
                                        <% }); %>
                                    </tbody>
                                  </table>
                                </div>

                                <% if (measurements.notes || measurements.comments) { %>
                                  <div class="notes">
                                    <strong>NOTES:</strong>
                                    <%= measurements.notes || measurements.comments %>
                                  </div>
                                  <% } %>
                          </div>
                      </div>
                      <% } %>

                        <%# 3B. SAMPLE MEASUREMENT ROUNDS %>
                          <% if (sampleMeasurementRounds && sampleMeasurementRounds.length> 0) { %>
                            <% sampleMeasurementRounds.forEach((round, roundIndex)=> { %>
                              <div class="section">
                                <% renderSectionHeader('Sample Measurements - ' + round.name); %>
          <div class="section-content">
            <div class="info-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 15px">
              <div class="info-item">
                <strong>Measurement Date</strong>
                <span><%= round.measurementDate || ' -' %></span>
                              </div>
                              <div class="info-item">
                                <strong>Reviewer</strong>
                                <span>
                                  <%= round.reviewer || '-' %>
                                </span>
                              </div>
                              <div class="info-item">
                                <strong>Requested Source</strong>
                                <span style="text-transform: capitalize">
                                  <%= round.requestedSource || 'original' %>
                                </span>
                              </div>
  </div>

  <% if (round.measurements && round.measurements.length> 0) { %>
    <div style="overflow-x: auto">
      <table class="measurement-table" style="font-size: 8px">
        <thead>
          <tr>
            <th style="width: 8%">POM</th>
            <th style="width: 12%">Point</th>
            <th style="width: 5%">-Tol</th>
            <th style="width: 5%">+Tol</th>
            <th style="width: 8%">Requested</th>
            <th style="width: 8%">Measured</th>
            <th style="width: 7%">Diff</th>
            <th style="width: 8%">Revised</th>
            <th style="width: 39%">Comments</th>
          </tr>
        </thead>
        <tbody>
          <% round.measurements.forEach((entry, idx)=> { %>
            <tr style="<%= idx % 2 === 1 ? 'background: #e8e8e8;' : '' %>">
              <td>
                <%= entry.pomCode || '-' %>
              </td>
              <td style="text-align: left">
                <%= entry.pomName || '-' %>
              </td>
              <td>
                <%= entry.toleranceMinus || '0' %>
              </td>
              <td>
                <%= entry.tolerancePlus || '0' %>
              </td>
              <td>
                <% const baseSize=measurements?.baseSize || 'M' ; %>
                  <%= entry.requested?.[baseSize] || '-' %>
              </td>
              <td>
                <%= entry.measured?.[baseSize] || '-' %>
              </td>
              <td style="<%= parseFloat(entry.diff?.[baseSize] || 0) > 0 ? 'color: red; font-weight: bold;' : '' %>">
                <%= entry.diff?.[baseSize] || '-' %>
              </td>
              <td>
                <%= entry.revised?.[baseSize] || '-' %>
              </td>
              <td style="text-align: left; font-size: 7px">
                <%= entry.comments?.[baseSize] || '-' %>
              </td>
            </tr>
            <% }); %>
        </tbody>
      </table>
    </div>
    <% } %>
      <% if (round.overallComments && round.overallComments !=='‚Äî' ) { %>
        <div class="notes" style="margin-top: 10px">
          <strong>OVERALL COMMENTS:</strong>
          <%- round.overallComments %>
        </div>
        <% } %>
          <% if (round.editorContent && round.editorContent.trim() !=='' ) { %>
            <div class="notes" style="margin-top: 10px">
              <strong>DETAILS:</strong>
              <%- round.editorContent %>
            </div>
            <% } %>
              </div>
              </div>
              <% }); %>
                <% } %>

                  <%# 4. COLORWAYS %>
                    <% if (colorways && colorways.length> 0) { %>
                      <div class="section">
                        <% renderSectionHeader('Colorways'); %>
                          <div class="section-content">
                            <div class="info-grid" style="margin-bottom: 20px">
                              <% colorways.forEach(color=> { %>
                                <div class="info-item">
                                  <div style="font-weight: 700; text-transform: uppercase; font-size: 11px; margin-bottom: 4px;">
                                    <%= color.name || 'Color' %>
                                  </div>
                                  <div style="font-size: 11px; margin-bottom: 6px;">
                                    Code: <%= color.code || '000' %>
                                  </div>
                                  <% if (color.imageUrl && color.imageUrl !== '‚Äî' && !color.imageUrl.includes('No Image')) { %>
                                    <div style="text-align: left; margin-top: 6px;">
                                      <img src="<%= color.imageUrl %>" alt="Colorway Image"
                                        style="max-width: 80px; max-height: 80px; border: 1px solid #ccc; border-radius: 4px; object-fit: contain;" />
                                    </div>
                                  <% } %>
                                </div>
                                <% }); %>
                            </div>
                          </div>
                      </div>
                      <% } %>

                        <%# 5. CONSTRUCTION %>
                          <% if (howToMeasures && howToMeasures.length> 0) { %>
                            <div class="section">
                              <% renderSectionHeader('Construction'); %>
                                <div class="section-content">
                                  <% howToMeasures.forEach((item, index)=> { %>
                                    <div
                                      style="border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; page-break-inside: avoid;">
                                      <div style="display: grid; grid-template-columns: 3fr 2fr; gap: 15px">
                                        <div>
                                          <h3 style="margin: 0 0 10px 0; font-size: 12px; color: #333">
                                            <%= item.stepNumber || (index + 1) %>. <%= item.pomName || item.pomCode
                                                || 'Measurement Point' %>
                                          </h3>
                                          <% if (item.pomCode) { %>
                                            <p style="margin: 5px 0; font-size: 9px; color: #666">
                                              <strong>Code:</strong>
                                              <%= item.pomCode %>
                                            </p>
                                            <% } %>
                                              <% if (item.description) { %>
                                                <p style="margin: 10px 0; font-size: 10px; line-height: 1.5">
                                                  <%= item.description %>
                                                </p>
                                                <% } %>
                                                  <% if (item.steps && item.steps.length> 0) { %>
                                                    <div style="margin-top: 10px">
                                                      <strong style="font-size: 10px">Steps:</strong>
                                                      <ol
                                                        style="margin: 5px 0; padding-left: 20px; font-size: 9px; line-height: 1.5;">
                                                        <% item.steps.forEach(step=> { %>
                                                          <li style="margin-bottom: 5px">
                                                            <%= step %>
                                                          </li>
                                                          <% }); %>
                                                      </ol>
                                                    </div>
                                                    <% } %>
                                                      <% if (item.tips && item.tips.length> 0) { %>
                                                        <div
                                                          style="margin-top: 10px; background: #fffbeb; padding: 8px; border-left: 3px solid #f59e0b;">
                                                          <strong style="font-size: 9px; color: #92400e">üí°
                                                            Tips:</strong>
                                                          <ul
                                                            style="margin: 5px 0; padding-left: 20px; font-size: 9px; line-height: 1.4;">
                                                            <% item.tips.forEach(tip=> { %>
                                                              <li style="margin-bottom: 3px">
                                                                <%= tip %>
                                                              </li>
                                                              <% }); %>
                                                          </ul>
                                                        </div>
                                                        <% } %>
                                                          <% if (item.commonMistakes && item.commonMistakes.length> 0) {
                                                            %>
                                                            <div
                                                              style="margin-top: 10px; background: #fef2f2; padding: 8px; border-left: 3px solid #ef4444;">
                                                              <strong style="font-size: 9px; color: #991b1b">‚ö†Ô∏è Common
                                                                Mistakes:</strong>
                                                              <ul
                                                                style="margin: 5px 0; padding-left: 20px; font-size: 9px; line-height: 1.4;">
                                                                <% item.commonMistakes.forEach(mistake=> { %>
                                                                  <li style="margin-bottom: 3px">
                                                                    <%= mistake %>
                                                                  </li>
                                                                  <% }); %>
                                                              </ul>
                                                            </div>
                                                            <% } %>
                                        </div>
                                        <% if (item.imageUrl) { %>
                                          <div style="text-align: center">
                                            <img src="<%= item.imageUrl %>" alt="<%= item.pomName || 'Measurement' %>"
                                              style="max-width: 320px; max-height: 220px; width: auto; height: auto; border: 1px solid #ddd; border-radius: 4px; object-fit: contain;" />
                                          </div>
                                          <% } %>
                                      </div>
                                    </div>
                                    <% }); %>
                                </div>
                            </div>
                            <% } %>

                              <%# 6. PACKING %>
                                <% if (packingNotes && packingNotes !=='‚Äî' ) { %>
                                  <div class="section">
                                    <% renderSectionHeader('Packing'); %>
                                      <div class="section-content">
                                        <div
                                          style="background: #f8fafc; border: 1px solid #e1e7ee; border-radius: 6px; padding: 20px; font-size: 10px; line-height: 1.6;">
                                          <%- packingNotes %>
                                        </div>
                                      </div>
                                  </div>
                                  <% } %>

                                    <!-- <%# 7. REVISION HISTORY %>
                                  <% if (revisionHistory && revisionHistory.length> 0) { %>
                                    <div class="section">
                                      <% renderSectionHeader('Revision History'); %>
                                        <div class="section-content">
                                          <table>
                                            <thead>
                                              <tr>
                                                <th style="width: 10%">Version</th>
                                                <th style="width: 20%">Modified By</th>
                                                <th style="width: 15%">Date</th>
                                                <th style="width: 45%">Description</th>
                                                <th style="width: 10%">Status</th>
                                              </tr>
                                            </thead>
                                            <tbody>
                                              <% revisionHistory.forEach((rev, idx)=> { %>
                                                <tr class="<%= idx % 2 === 1 ? 'alt-row' : '' %>">
                                                  <td style="text-align: center; font-weight: bold">
                                                    <%= rev.version || '-' %>
                                                  </td>
                                                  <td>
                                                    <%= rev.modifiedBy || '-' %>
                                                  </td>
                                                  <td>
                                                    <%= rev.modifiedAt || '-' %>
                                                  </td>
                                                  <td style="font-size: 9px">
                                                    <%= rev.description || '-' %>
                                                  </td>
                                                  <td style="text-align: center">
                                                    <span
                                                      style="padding: 3px 8px; border-radius: 3px; font-size: 8px; background: <%= rev.status === 'Approved' ? '#d1fae5' : '#fee2e2' %>; color: <%= rev.status === 'Approved' ? '#065f46' : '#991b1b' %>;">
                                                      <%= rev.status || 'Draft' %>
                                                    </span>
                                                  </td>
                                                </tr>
                                                <% }); %>
                                            </tbody>
                                          </table>
                                        </div>
                                    </div>
                                    <% } %> -->

                                    <!-- <%# 8. CARE INSTRUCTIONS %>
                                      <% if (meta.fabricDescription ||
                                        articleSummary?.fabricAndComposition?.fabricDescription) { %>
                                        <div class="section">
                                          <% renderSectionHeader('Care Instructions'); %>
                                            <div class="section-content">
                                              <div
                                                style="display: grid; grid-template-columns: auto 1fr; gap: 20px; align-items: start;">
                                                <div>
                                                  <strong style="display: block; margin-bottom: 8px">Care
                                                    Symbols:</strong>
                                                  <div style="font-size: 24px; line-height: 1.8">
                                                    ‚öø Machine Wash Warm<br />
                                                    ‚É† Do Not Bleach<br />
                                                    ‚óé Tumble Dry Low<br />
                                                    ‚ñΩ Cool Iron
                                                  </div>
                                                </div>
                                                <div>
                                                  <strong style="display: block; margin-bottom: 8px">Fiber Content &
                                                    Instructions:</strong>
                                                  <% if (meta.fabricDescription ||
                                                    articleSummary?.fabricAndComposition?.materialInfo) { %>
                                                    <p style="margin-bottom: 8px">
                                                      <strong>
                                                        <%= meta.fabricDescription ||
                                                          articleSummary.fabricAndComposition.materialInfo %>
                                                      </strong>
                                                    </p>
                                                    <% } %>
                                                      <p style="margin-bottom: 5px">MACHINE WASH WARM, DO NOT BLEACH,
                                                        TUMBLE DRY LOW, COOL IRON.</p>
                                                      <p style="margin-bottom: 5px">LAVAR A M√ÅQUINA TIBIO, NO
                                                        BLANQUEADOR, SECADO TEMP BAJA, PLANCHA FRIA.</p>
                                                      <p>LAVAGE EN MACHINE CHAUD, NE PAS JAVELLISER, S√àCHE-LINGE √Ä
                                                        FAIBLE, FER REFROIDIR.</p>
                                                </div>
                                              </div>
                                            </div>
                                        </div>
                                        <% } %> -->

                                    <%# FOOTER %>
                                      <div
                                        style="margin-top: 30px; padding-top: 15px; border-top: 2px solid #ddd; text-align: center; font-size: 9px; color: #666;">
                                        <strong>Powered by WFX</strong> | All rights reserved<br />
                                        Printed on <%= generatedAt %> by <%= printedBy %>
                                      </div>
                                      </div>
</body>

</html>